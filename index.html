<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Documentation</title><meta name="description" content="Documentation for Documentation"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">Documentation</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>Documentation</h2></div><div class="tsd-panel tsd-typography"><a id="md:railway-effects" class="tsd-anchor"></a><h1 class="tsd-anchor-link"><code>railway-effects</code><a href="#md:railway-effects" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><code>railway-effects</code> is a collection of modules that provides a consistent methodology for managing side effects and the errors produced by them consistently and comprehensively. It standardizes the Error creation process to create errors tagged with a <code>code</code> property, provides tooling to wrap side effects in a <code>Result</code> instance that represents success &amp; failure, and wraps other ecosystem tools to fit comfortably within this model.</p>
<a id="md:how-to-use" class="tsd-anchor"></a><h2 class="tsd-anchor-link">How to Use<a href="#md:how-to-use" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>First, install the <code>@railway-effects/result</code>&amp; <code>/error</code> packages:</p>
<pre><code class="sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> </span><span class="hl-2">@railway-effects/result</span><span class="hl-1"> </span><span class="hl-2">@railway-effects/error</span>
</code><button type="button">Copy</button></pre>

<p>These two packages make up the core of the <code>railway-effects</code> approach.</p>
<a id="md:creating-a-basic-api-effect" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Creating a Basic API Effect<a href="#md:creating-a-basic-api-effect" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For a given effect, you'll need to define a few parts for it. Let's use an API call with <code>fetch</code> as an example.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">UnknownError</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@railway-effects/error&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-5">*</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">R</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@railway-effects/result&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">getUsers</span><span class="hl-1"> = (): </span><span class="hl-6">R</span><span class="hl-1">.</span><span class="hl-6">AsyncResult</span><span class="hl-1">&lt;</span><span class="hl-6">unknown</span><span class="hl-1">, </span><span class="hl-6">UnknownError</span><span class="hl-1">&gt; </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">tryAsync</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">response</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&quot;/api/users&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">body</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">body</span><span class="hl-1">;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">UnknownError</span><span class="hl-1">(</span><span class="hl-2">&quot;Unknown error fetching users&quot;</span><span class="hl-1">, { </span><span class="hl-4">cause:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }),</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><code>AsyncResult</code> as a convenience type for <code>Promise&lt;Result&gt;</code>. The resulting function can be used as follows:</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getUsers</span><span class="hl-1">();</span><br/><br/><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">match</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">success</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">alert</span><span class="hl-1">(</span><span class="hl-2">`Got users: </span><span class="hl-5">${</span><span class="hl-4">data</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">error</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">alert</span><span class="hl-1">(</span><span class="hl-2">`Error fetching users: </span><span class="hl-5">${</span><span class="hl-4">error</span><span class="hl-8">.</span><span class="hl-4">message</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>While this looks like <code>try/catch</code> with extra steps, we already have an improvement in the error case. While TypeScript by default will treat the thrown error as <code>unknown</code>, we wrapped it up in an <code>UnknownError</code>, which provides some extra details (including a <code>code</code> property we can match on as well as <code>stack</code> &amp; <code>message</code>).</p>
<a id="md:adding-error-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Adding Error Handling<a href="#md:adding-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>However, this doesn't provide us much information about either what errors happened or what we got back from the API. Let's solve the errors first:</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">BaseError</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@railway-effects/error&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-5">*</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">R</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@railway-effects/result&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">FetchError</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">BaseError</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">readonly</span><span class="hl-1"> </span><span class="hl-4">code</span><span class="hl-1"> = </span><span class="hl-2">&quot;FETCH&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">JSONParseError</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">BaseError</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">readonly</span><span class="hl-1"> </span><span class="hl-4">code</span><span class="hl-1"> = </span><span class="hl-2">&quot;JSON_PARSE&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">getUsers</span><span class="hl-1"> = (): </span><span class="hl-6">R</span><span class="hl-1">.</span><span class="hl-6">AsyncResult</span><span class="hl-1">&lt;</span><span class="hl-6">unknown</span><span class="hl-1">, </span><span class="hl-6">FetchError</span><span class="hl-1"> | </span><span class="hl-6">JSONParseError</span><span class="hl-1">&gt; </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">tryAsync</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&quot;/api/users&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">FetchError</span><span class="hl-1">(</span><span class="hl-2">&quot;A fetch error occurred getting users&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-4">cause:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">,</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">andThen</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">, (</span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">tryAsync</span><span class="hl-1">(</span><br/><span class="hl-1">      () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">(),</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">JSONParseError</span><span class="hl-1">(</span><span class="hl-2">&quot;Error parsing JSON body&quot;</span><span class="hl-1">, { </span><span class="hl-4">cause:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }),</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>First we define two new Error classes that map to the potential errors that can occur in this sequence of effects. We split the two async calls into separate steps in the pipeline, removing the need for <code>UnknownError</code>. <code>R.andThen</code> will only run the provided callback if the <code>result</code> is in the success state, which makes it easy to chain a sequence of effects with a chunk of data, accumulating the type of errors in the Result.</p>
<p>All of this enables us to more specifically understand the error generated by the pipeline:</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getUsers</span><span class="hl-1">();</span><br/><br/><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">match</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">success</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">alert</span><span class="hl-1">(</span><span class="hl-2">`Got users: </span><span class="hl-5">${</span><span class="hl-4">data</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">error</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">switch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">code</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&quot;FETCH&quot;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">alert</span><span class="hl-1">(</span><span class="hl-2">&quot;Error occurred fetching users&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&quot;JSON_PARSE&quot;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">alert</span><span class="hl-1">(</span><span class="hl-2">&quot;Error occurred parsing returned JSON body&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#exceptions"><code>fetch</code> throws a lot of different errors</a>, and for your given effect, you can expand the errors returned in the result to handle all possible scenarios, fully typed.</p>
<a id="md:validating-external-reads" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validating External Reads<a href="#md:validating-external-reads" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Unfortunately, the Result's success state is still <code>unknown</code>. Let's fix that with <code>zod</code>:</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">BaseError</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@railway-effects/error&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-5">*</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">R</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@railway-effects/result&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">parseWithResult</span><span class="hl-1">, </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">ParseError</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@railway-effects/zod&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">z</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;zod&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">FetchError</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">BaseError</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">readonly</span><span class="hl-1"> </span><span class="hl-4">code</span><span class="hl-1"> = </span><span class="hl-2">&quot;FETCH&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">JSONParseError</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">BaseError</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">readonly</span><span class="hl-1"> </span><span class="hl-4">code</span><span class="hl-1"> = </span><span class="hl-2">&quot;JSON_PARSE&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">UserBodySchema</span><span class="hl-1"> = </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">array</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">object</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">string</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-4">username:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">string</span><span class="hl-1">(),</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">getUsers</span><span class="hl-1"> = (): </span><span class="hl-6">R</span><span class="hl-1">.</span><span class="hl-6">AsyncResult</span><span class="hl-1">&lt;</span><br/><span class="hl-1">  </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-6">infer</span><span class="hl-1">&lt;</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-4">UserBodySchema</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-6">FetchError</span><span class="hl-1"> | </span><span class="hl-6">JSONParseError</span><span class="hl-1"> | </span><span class="hl-6">ParseError</span><br/><span class="hl-1">&gt; </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">tryAsync</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&quot;/api/users&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">FetchError</span><span class="hl-1">(</span><span class="hl-2">&quot;A fetch error occurred getting users&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-4">cause:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">,</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">result1</span><span class="hl-1"> = </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">andThen</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">, (</span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">tryAsync</span><span class="hl-1">(</span><br/><span class="hl-1">      () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">(),</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">JSONParseError</span><span class="hl-1">(</span><span class="hl-2">&quot;Error parsing JSON body&quot;</span><span class="hl-1">, { </span><span class="hl-4">cause:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }),</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">andThen</span><span class="hl-1">(</span><span class="hl-4">result1</span><span class="hl-1">, (</span><span class="hl-4">body</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">parseWithResult</span><span class="hl-1">(</span><span class="hl-4">UserBodySchema</span><span class="hl-1">, </span><span class="hl-4">body</span><span class="hl-1">));</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>Couple of changes here: First, we create a <a href="https://zod.dev/">Zod</a> schema for the body returned by the API, <code>UserBodySchema</code>. Next, we add an additional step to parse the <code>body</code> with the schema and wrap it in a Result. The Result is returned in the success state with the parsed data if it succeeds, or in the error state with a <code>ZodParseError</code> if it fails. Lastly, this updates the type with an explicit type in the success scenario and adds an additional <code>ZodParseError</code> to the error scenario.</p>
<p>All of this flows forward to give us more full-fledged typing and error handling:</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getUsers</span><span class="hl-1">();</span><br/><br/><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">match</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">success</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-0">alert</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">`Got users: </span><span class="hl-5">${</span><span class="hl-4">data</span><br/><span class="hl-8">        .</span><span class="hl-0">map</span><span class="hl-8">((</span><span class="hl-4">user</span><span class="hl-8">) </span><span class="hl-5">=&gt;</span><span class="hl-8"> </span><span class="hl-4">user</span><span class="hl-8">.</span><span class="hl-4">username</span><span class="hl-8">)</span><br/><span class="hl-8">        .</span><span class="hl-0">join</span><span class="hl-8">(</span><span class="hl-2">&quot;, &quot;</span><span class="hl-8">)</span><br/><span class="hl-8">        .</span><span class="hl-0">trim</span><span class="hl-8">()</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">  </span><span class="hl-0">error</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">switch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">code</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&quot;FETCH&quot;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">alert</span><span class="hl-1">(</span><span class="hl-2">&quot;Error occurred fetching users&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&quot;JSON_PARSE&quot;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">alert</span><span class="hl-1">(</span><span class="hl-2">&quot;Error occurred parsing returned JSON body&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">case</span><span class="hl-1"> </span><span class="hl-2">&quot;ZOD_PARSE&quot;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">alert</span><span class="hl-1">(</span><span class="hl-2">&quot;Returned body did not match schema&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>We have specific types on the <code>data</code> returned by the API and we have an opportunity to handle the Zod parsing error.</p>
<a id="md:simplifying-the-sequence" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Simplifying the sequence<a href="#md:simplifying-the-sequence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>You may have noticed a couple of warts in <code>getUsers</code>. For every step, we're stuck creating a new <code>result</code> object and giving it another variable name. <code>result1</code> is not a good variable name, and anything else is verbose and unnecessary when it's basically a temp var to pass into the next step in the sequence. To alleviate this, use <code>andThenSeq</code> to chain a sequence of effects:</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">getUsers</span><span class="hl-1"> = (): </span><span class="hl-6">R</span><span class="hl-1">.</span><span class="hl-6">AsyncResult</span><span class="hl-1">&lt;</span><br/><span class="hl-1">  </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-6">infer</span><span class="hl-1">&lt;</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-4">UserBodySchema</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-6">FetchError</span><span class="hl-1"> | </span><span class="hl-6">JSONParseError</span><span class="hl-1"> | </span><span class="hl-6">ParseError</span><br/><span class="hl-1">&gt; </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">andThenSeq</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">tryAsync</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&quot;/api/users&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">FetchError</span><span class="hl-1">(</span><span class="hl-2">&quot;A fetch error occurred getting users&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">          </span><span class="hl-4">cause:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">,</span><br/><span class="hl-1">        }),</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">    (</span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">tryAsync</span><span class="hl-1">(</span><br/><span class="hl-1">        () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">(),</span><br/><span class="hl-1">        (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">          </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">JSONParseError</span><span class="hl-1">(</span><span class="hl-2">&quot;Error parsing JSON body&quot;</span><span class="hl-1">, { </span><span class="hl-4">cause:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }),</span><br/><span class="hl-1">      ),</span><br/><span class="hl-1">    (</span><span class="hl-4">body</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">parseWithResult</span><span class="hl-1">(</span><span class="hl-4">UserBodySchema</span><span class="hl-1">, </span><span class="hl-4">body</span><span class="hl-1">),</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>Now, each callback is called only if the previous step returns a Result in the success state. These pipelines of effects then become very easy to build and sequence while handling errors consistently.</p>
<a id="md:philosophy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Philosophy<a href="#md:philosophy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Inspired by Rust's <code>Result</code> and other functional-style error handling, <code>railway-effects</code> attempts to implement a version of this in JavaScript/TypeScript in a way that feels more native to the language and easy to understand for developers otherwise unfamiliar with the paradigm. To those ends, the library has a few underlying principles.</p>
<a id="md:avoid-complex-functional-paradigms" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Avoid Complex Functional Paradigms<a href="#md:avoid-complex-functional-paradigms" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>While functional programming provides a strong foundation for solving a variety of programming tasks, without the requisite background knowledge in the underlying mathematical concepts that underpin functional programming, it can be very challenging for new developers to understand the control flow relative to the imperative style (with <code>try/catch</code>) that they're used to.</p>
<p><code>railway-effects</code> already represents a departure from a more traditional imperative approach, so the goal of the library is to make this useful &amp; understandable with a minimal reliance on deep functional concepts. This specifically means no currying, instead favoring a data-first API design that is comfortable to your typical <code>lodash</code> user.</p>
<a id="md:build-for-the-future" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Build for the Future<a href="#md:build-for-the-future" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The library is built to be significantly easier to use when paired with a future <a href="https://github.com/tc39/proposal-pipeline-operator">pipeline operator</a>. With the data-first design, any of the API functions can be used in a pipeline sequence, taking advantage of a future native JavaScript feature to design an API that is both classic &amp; forward-looking.</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">getUsers</span><span class="hl-1"> = (): </span><span class="hl-6">R</span><span class="hl-1">.</span><span class="hl-6">AsyncResult</span><span class="hl-1">&lt;</span><br/><span class="hl-1">  </span><span class="hl-6">z</span><span class="hl-1">.</span><span class="hl-6">infer</span><span class="hl-1">&lt;</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-4">UserBodySchema</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-6">FetchError</span><span class="hl-1"> | </span><span class="hl-6">JSONParseError</span><span class="hl-1"> | </span><span class="hl-6">ParseError</span><br/><span class="hl-1">&gt; </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">tryAsync</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&quot;/api/users&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">FetchError</span><span class="hl-1">(</span><span class="hl-2">&quot;A fetch error occurred getting users&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-4">cause:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">,</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">  ) |&gt; </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">andThen</span><span class="hl-1">(%, (</span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">tryAsync</span><span class="hl-1">(</span><br/><span class="hl-1">      () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">(),</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">JSONParseError</span><span class="hl-1">(</span><span class="hl-2">&quot;Error parsing JSON body&quot;</span><span class="hl-1">, { </span><span class="hl-4">cause:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }),</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">  ) |&gt; </span><span class="hl-7">R</span><span class="hl-1">.</span><span class="hl-0">andThen</span><span class="hl-1">(%, (</span><span class="hl-4">body</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">parseWithResult</span><span class="hl-1">(</span><span class="hl-4">UserBodySchema</span><span class="hl-1">, </span><span class="hl-4">body</span><span class="hl-1">));</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>While it still uses <code>andThen</code> instead of <code>andThenSeq</code>, it enables the full API to be used in the pipeline.</p>
<p>Additionally, the <code>switch</code> case for handling errors could use <a href="https://github.com/tc39/proposal-pattern-matching">pattern matching</a> to switch on &amp; extract relevant information from each error type. If you're interested in using pattern matching-like syntax today, we recommend <a href="https://github.com/gvergnaud/ts-pattern">ts-pattern</a>.</p>
<blockquote>
<p>![NOTE]
The Pattern Matching syntax is still in flux, so an example is not provided.</p>
</blockquote>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:railway-effects"><span>railway-<wbr/>effects</span></a><ul><li><a href="#md:how-to-use"><span>How to <wbr/>Use</span></a></li><li><ul><li><a href="#md:creating-a-basic-api-effect"><span>Creating a <wbr/>Basic API <wbr/>Effect</span></a></li><li><a href="#md:adding-error-handling"><span>Adding <wbr/>Error <wbr/>Handling</span></a></li><li><a href="#md:validating-external-reads"><span>Validating <wbr/>External <wbr/>Reads</span></a></li><li><a href="#md:simplifying-the-sequence"><span>Simplifying the sequence</span></a></li></ul></li><li><a href="#md:philosophy"><span>Philosophy</span></a></li><li><ul><li><a href="#md:avoid-complex-functional-paradigms"><span>Avoid <wbr/>Complex <wbr/>Functional <wbr/>Paradigms</span></a></li><li><a href="#md:build-for-the-future"><span>Build for the <wbr/>Future</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>Documentation</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>